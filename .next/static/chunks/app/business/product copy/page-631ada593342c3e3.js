(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4246],{3119:(e,a,t)=>{Promise.resolve().then(t.bind(t,28240))},28240:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>d});var r=t(95155),i=t(12115),l=t(27364),s=t(951),o=t.n(s);function d(){let[e,a]=(0,i.useState)(null),[t,s]=(0,i.useState)([]),[d,c]=(0,i.useState)(""),[n,u]=(0,i.useState)(""),[p,m]=(0,i.useState)(""),[_,h]=(0,i.useState)([]),[g,x]=(0,i.useState)([]),[f,P]=(0,i.useState)(!1),[N,v]=(0,i.useState)(null),[j,w]=(0,i.useState)(""),[U,C]=(0,i.useState)(""),[I,b]=(0,i.useState)(""),[S,y]=(0,i.useState)([]),[F,E]=(0,i.useState)([]),[k,B]=(0,i.useState)(null),[G,M]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{let e=JSON.parse(sessionStorage.getItem("user")||"{}");if(null==e?void 0:e.email){let{data:t,error:r}=await l.N.from("users").select("user_id, email, phone, whatsapp").eq("email",e.email).single();r||!t?B("Failed to fetch user data. Please log in again."):(a(t),D(t.user_id))}else B("User not logged in. Please log in first.")})()},[]);let D=async e=>{let{data:a,error:t}=await l.N.from("products").select("*").eq("user_id",e);t?B("Failed to fetch products."):s(a||[])},A=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.target.files){let t=Array.from(e.target.files);a?(y(t),E(t.map(e=>URL.createObjectURL(e)))):(h(t),x(t.map(e=>({url:"",loading:!0}))),t.forEach((e,a)=>{let t=new FileReader;t.onloadend=()=>{x(e=>{let r=[...e];return r[a]={url:t.result,loading:!1},r})},t.readAsDataURL(e)}))}},O=async()=>{if(!e){B("User information is missing. Please log in again.");return}if(!d||!n||!p||0===_.length){B("All fields are required.");return}P(!0),B(null),M(null);try{let a=[];for(let t of _){let r=t.name.split(".").pop(),i="".concat(e.user_id,"_").concat(Date.now(),".").concat(r),{data:s,error:o}=await l.N.storage.from("product-media").upload("media/".concat(i),t);if(o)throw Error("Error uploading media files.");let{publicUrl:d}=l.N.storage.from("product-media").getPublicUrl("media/".concat(i)).data;d&&a.push(d)}let{error:t}=await l.N.from("products").insert({user_id:e.user_id,name:d,description:n,price_inr:parseFloat(p),media_urls:a});if(t)throw Error("Failed to save product.");M("Product uploaded successfully!"),c(""),u(""),m(""),h([]),x([]),D(e.user_id)}catch(e){B(e instanceof Error?e.message:"An unknown error occurred.")}finally{P(!1)}},J=e=>{v(e.id),w(e.name),C(e.description),b(e.price_inr.toString()),E(e.media_urls),y([])},R=()=>{v(null),w(""),C(""),b(""),y([]),E([])},W=async()=>{if(!N||!j||!U||!I){B("All fields are required.");return}B(null),M(null);try{let a=[];if(S.length>0)for(let t of S){let r=t.name.split(".").pop(),i="".concat(null==e?void 0:e.user_id,"_").concat(Date.now(),".").concat(r),{data:s,error:o}=await l.N.storage.from("product-media").upload("media/".concat(i),t);if(o)throw Error("Error uploading media files.");let{publicUrl:d}=l.N.storage.from("product-media").getPublicUrl("media/".concat(i)).data;d&&a.push(d)}else a.push(...F);let{error:t}=await l.N.from("products").update({name:j,description:U,price_inr:parseFloat(I),media_urls:a}).eq("id",N);if(t)throw Error("Failed to update product.");M("Product updated successfully!"),R(),D((null==e?void 0:e.user_id)||"")}catch(e){B(e instanceof Error?e.message:"An unknown error occurred.")}};return(0,r.jsxs)("div",{className:o().container,children:[(0,r.jsx)("h1",{className:o().title,children:"Upload Product"}),k&&(0,r.jsx)("p",{className:o().error,children:k}),G&&(0,r.jsx)("p",{className:o().success,children:G}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productName",children:"Product Name"}),(0,r.jsx)("input",{id:"productName",type:"text",value:d,onChange:e=>c(e.target.value),className:o().input})]}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productDescription",children:"Product Description"}),(0,r.jsx)("textarea",{id:"productDescription",value:n,onChange:e=>u(e.target.value),className:o().textarea})]}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productPrice",children:"Product Price (INR)"}),(0,r.jsx)("input",{id:"productPrice",type:"text",value:p,onChange:e=>m(e.target.value),className:o().input})]}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productMedia",children:"Upload Media"}),(0,r.jsx)("input",{id:"productMedia",type:"file",multiple:!0,accept:"image/*,video/*",onChange:e=>A(e),className:o().fileInput}),(0,r.jsx)("div",{className:o().previewContainer,children:g.map((e,a)=>(0,r.jsx)("div",{className:o().previewItem,children:e.loading?(0,r.jsx)("p",{children:"Loading..."}):(0,r.jsx)("img",{src:e.url,alt:"Preview ".concat(a+1),className:o().previewImage})},a))})]}),(0,r.jsx)("button",{onClick:O,disabled:f,className:o().uploadButton,children:f?"Uploading...":"Upload Product"})]}),(0,r.jsx)("h1",{className:o().title,children:"Your Products"}),(0,r.jsx)("div",{className:o().productGrid,children:t.map(e=>(0,r.jsx)("div",{className:o().productCard,children:N===e.id?(0,r.jsxs)("div",{className:o().editForm,children:[(0,r.jsx)("h3",{children:"Edit Product"}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{children:"Product Name"}),(0,r.jsx)("input",{type:"text",value:j,onChange:e=>w(e.target.value),className:o().input})]}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{children:"Description"}),(0,r.jsx)("textarea",{value:U,onChange:e=>C(e.target.value),className:o().textarea})]}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{children:"Price (INR)"}),(0,r.jsx)("input",{type:"text",value:I,onChange:e=>b(e.target.value),className:o().input})]}),(0,r.jsxs)("div",{className:o().formGroup,children:[(0,r.jsx)("label",{children:"Media"}),(0,r.jsx)("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:e=>A(e,!0),className:o().fileInput}),(0,r.jsx)("div",{className:o().previewContainer,children:F.map((e,a)=>(0,r.jsx)("img",{src:e,alt:"Preview ".concat(a),className:o().previewImage},a))})]}),(0,r.jsx)("button",{onClick:W,className:o().saveButton,children:"Save Changes"}),(0,r.jsx)("button",{onClick:R,className:o().cancelButton,children:"Cancel"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{children:e.name}),(0,r.jsx)("p",{children:e.description}),(0,r.jsxs)("p",{children:["Price: â‚¹",e.price_inr]}),(0,r.jsx)("div",{className:o().mediaContainer,children:e.media_urls.map((e,a)=>(0,r.jsx)("img",{src:e,alt:"Media ".concat(a),className:o().media},a))}),(0,r.jsx)("button",{onClick:()=>J(e),className:o().editButton,children:"Edit"})]})},e.id))})]})}},27364:(e,a,t)=>{"use strict";t.d(a,{N:()=>r});let r=(0,t(35974).UU)("https://mdxeolqfiosscdommyhc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1keGVvbHFmaW9zc2Nkb21teWhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk4ODc2NDMsImV4cCI6MjA0NTQ2MzY0M30.6FDluVEiMbeaxQI9BD633IhtxnEwh3f5WzGT5YDOylA",{auth:{persistSession:!0,autoRefreshToken:!0}})},951:e=>{e.exports={container:"ProductUploadPage_container__W8E_u",title:"ProductUploadPage_title__AXCjs",error:"ProductUploadPage_error__tWdr4",success:"ProductUploadPage_success__dWyt_",formGroup:"ProductUploadPage_formGroup__a0Peu",label:"ProductUploadPage_label__pOddW",input:"ProductUploadPage_input__Z_Fvk",textarea:"ProductUploadPage_textarea__ow_kc",fileInput:"ProductUploadPage_fileInput__ni63T",uploadButton:"ProductUploadPage_uploadButton__Ymfs5",saveButton:"ProductUploadPage_saveButton__YBzxB",editButton:"ProductUploadPage_editButton__M_mN9",cancelButton:"ProductUploadPage_cancelButton__CjCxA",productGrid:"ProductUploadPage_productGrid__iFQ3Z",productCard:"ProductUploadPage_productCard__EyZAK",editForm:"ProductUploadPage_editForm__rw3W8",previewContainer:"ProductUploadPage_previewContainer__b5Hcx",previewItem:"ProductUploadPage_previewItem__GSUdL",previewImage:"ProductUploadPage_previewImage__mwvqr",mediaContainer:"ProductUploadPage_mediaContainer__aO_Ns",media:"ProductUploadPage_media__TBwIr"}}},e=>{var a=a=>e(e.s=a);e.O(0,[6904,5974,8441,1517,7358],()=>a(3119)),_N_E=e.O()}]);