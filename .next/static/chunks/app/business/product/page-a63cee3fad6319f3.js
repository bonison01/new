(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2793],{13425:(e,a,t)=>{Promise.resolve().then(t.bind(t,13471))},13471:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>o});var r=t(95155),s=t(12115),i=t(27364),l=t(85854),d=t.n(l);function o(){let[e,a]=(0,s.useState)(null),[t,l]=(0,s.useState)([]),[o,c]=(0,s.useState)(""),[u,n]=(0,s.useState)(""),[p,m]=(0,s.useState)(""),[_,h]=(0,s.useState)([]),[P,g]=(0,s.useState)([]),[x,f]=(0,s.useState)(!1),[N,v]=(0,s.useState)(null),[j,U]=(0,s.useState)(""),[w,b]=(0,s.useState)(""),[y,I]=(0,s.useState)(""),[C,S]=(0,s.useState)([]),[F,M]=(0,s.useState)([]),[B,E]=(0,s.useState)(null),[k,L]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let e=JSON.parse(sessionStorage.getItem("user")||"{}");if(null==e?void 0:e.email){let{data:t,error:r}=await i.N.from("users").select("user_id, email, phone, whatsapp").eq("email",e.email).single();r||!t?E("Failed to fetch user data. Please log in again."):(a(t),D(t.user_id))}else E("User not logged in. Please log in first.")})()},[]);let D=async e=>{let{data:a,error:t}=await i.N.from("new_products").select("*").eq("user_id",e);t?E("Failed to fetch products."):l(a||[])},G=async a=>{if(!e){E("User information is missing. Please log in again.");return}if(window.confirm("Are you sure you want to delete this product?")){E(null),L(null);try{let{error:t}=await i.N.from("new_products").delete().eq("id",a).eq("user_id",e.user_id);if(t)throw Error("Failed to delete product.");L("Product deleted successfully!"),D(e.user_id)}catch(e){E(e instanceof Error?e.message:"An unknown error occurred.")}}},O=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.target.files){let t=Array.from(e.target.files);a?(S(t),M(t.map(e=>URL.createObjectURL(e)))):(h(t),g(t.map(()=>({url:"",loading:!0}))),t.forEach((e,a)=>{let t=new FileReader;t.onloadend=()=>{g(e=>{let r=[...e];return r[a]={url:t.result,loading:!1},r})},t.readAsDataURL(e)}))}},A=async(e,a)=>{let t=[];for(let r of e){let e=r.name.split(".").pop(),s="".concat(a,"_").concat(Date.now(),".").concat(e),{data:l,error:d}=await i.N.storage.from("product-media").upload("media/".concat(s),r);if(d)throw Error("Error uploading media files.");let{publicUrl:o}=i.N.storage.from("product-media").getPublicUrl("media/".concat(s)).data;o&&t.push(o)}return t},R=async()=>{if(!e){E("User information is missing. Please log in again.");return}if(!o||!u||!p||0===_.length){E("All fields are required.");return}f(!0),E(null),L(null);try{let a=await A(_,e.user_id),{error:t}=await i.N.from("new_products").insert({user_id:e.user_id,name:o,description:u,price_inr:parseFloat(p),media_urls:a});if(t)throw Error("Failed to save product.");L("Product uploaded successfully!"),c(""),n(""),m(""),h([]),g([]),D(e.user_id)}catch(e){E(e instanceof Error?e.message:"An unknown error occurred.")}finally{f(!1)}},q=e=>{v(e.id),U(e.name),b(e.description),I(e.price_inr.toString()),M(e.media_urls),S([])},z=()=>{v(null),U(""),b(""),I(""),S([]),M([])},J=async()=>{if(!N||!j||!w||!y){E("All fields are required.");return}E(null),L(null);try{let a=C.length>0?await A(C,(null==e?void 0:e.user_id)||""):F,{error:t}=await i.N.from("new_products").update({name:j,description:w,price_inr:parseFloat(y),media_urls:a}).eq("id",N);if(t)throw Error("Failed to update product.");L("Product updated successfully!"),z(),D((null==e?void 0:e.user_id)||"")}catch(e){E(e instanceof Error?e.message:"An unknown error occurred.")}};return(0,r.jsxs)("div",{className:d().container,children:[(0,r.jsx)("h1",{className:d().title,children:"Upload Product"}),B&&(0,r.jsx)("p",{className:d().error,children:B}),k&&(0,r.jsx)("p",{className:d().success,children:k}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productName",children:"Product Name"}),(0,r.jsx)("input",{id:"productName",type:"text",value:o,onChange:e=>c(e.target.value),className:d().input})]}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productDescription",children:"Product Description"}),(0,r.jsx)("textarea",{id:"productDescription",value:u,onChange:e=>n(e.target.value),className:d().textarea})]}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productPrice",children:"Product Price (INR)"}),(0,r.jsx)("input",{id:"productPrice",type:"number",value:p,onChange:e=>m(e.target.value),className:d().input})]}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"productMedia",children:"Product Images/Videos"}),(0,r.jsx)("input",{id:"productMedia",type:"file",accept:"image/*,video/*",multiple:!0,onChange:O,className:d().fileInput}),(0,r.jsx)("div",{className:d().previews,children:P.map((e,a)=>(0,r.jsx)("div",{className:d().preview,children:e.loading?(0,r.jsx)("div",{children:"Loading..."}):(0,r.jsx)("img",{src:e.url,alt:"Preview ".concat(a),className:d().thumbnail})},a))})]}),(0,r.jsx)("button",{onClick:R,disabled:x,className:d().uploadButton,children:x?"Uploading...":"Upload Product"})]}),(0,r.jsx)("h2",{className:d().productListTitle,children:"Your Products"}),(0,r.jsx)("div",{className:d().productList,children:t.map(e=>(0,r.jsxs)("div",{className:d().productCard,children:[(0,r.jsx)("h3",{children:e.name}),(0,r.jsx)("p",{children:e.description}),(0,r.jsxs)("p",{children:["Price: â‚¹",e.price_inr]}),(0,r.jsx)("div",{className:d().thumbnailList,children:e.media_urls.slice(0,3).map((a,t)=>(0,r.jsx)("img",{src:a,alt:"Product ".concat(e.id),className:d().thumbnail},t))}),(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:()=>q(e),className:d().editButton,children:"Edit"}),(0,r.jsx)("button",{onClick:()=>G(e.id),className:d().deleteButton,children:"Delete"})]})]},e.id))}),N&&(0,r.jsx)("div",{className:d().editModalOverlay,children:(0,r.jsxs)("div",{className:d().editModal,children:[(0,r.jsx)("h3",{children:"Edit Product"}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"updatedName",children:"Product Name"}),(0,r.jsx)("input",{id:"updatedName",type:"text",value:j,onChange:e=>U(e.target.value),className:d().input})]}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"updatedDescription",children:"Product Description"}),(0,r.jsx)("textarea",{id:"updatedDescription",value:w,onChange:e=>b(e.target.value),className:d().textarea})]}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"updatedPrice",children:"Product Price (INR)"}),(0,r.jsx)("input",{id:"updatedPrice",type:"number",value:y,onChange:e=>I(e.target.value),className:d().input})]}),(0,r.jsxs)("div",{className:d().formGroup,children:[(0,r.jsx)("label",{htmlFor:"updatedMedia",children:"Update Images/Videos"}),(0,r.jsx)("input",{id:"updatedMedia",type:"file",accept:"image/*,video/*",multiple:!0,onChange:e=>O(e,!0),className:d().fileInput}),(0,r.jsxs)("div",{className:d().previews,children:[F.map((e,a)=>(0,r.jsx)("div",{className:d().preview,children:(0,r.jsx)("img",{src:e,alt:"Edit Preview ".concat(a),className:d().thumbnail})},a)),C.map((e,a)=>(0,r.jsx)("div",{className:d().preview,children:"New"},a))]})]}),(0,r.jsx)("button",{onClick:J,className:d().saveButton,children:"Save Changes"}),(0,r.jsx)("button",{onClick:z,className:d().cancelButton,children:"Cancel"})]})})]})}},27364:(e,a,t)=>{"use strict";t.d(a,{N:()=>r});let r=(0,t(35974).UU)("https://mdxeolqfiosscdommyhc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1keGVvbHFmaW9zc2Nkb21teWhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk4ODc2NDMsImV4cCI6MjA0NTQ2MzY0M30.6FDluVEiMbeaxQI9BD633IhtxnEwh3f5WzGT5YDOylA",{auth:{persistSession:!0,autoRefreshToken:!0}})},85854:e=>{e.exports={container:"ProductUploadPage_container__7dL5D",title:"ProductUploadPage_title__zdsyA",error:"ProductUploadPage_error__wqSxz",success:"ProductUploadPage_success__W3gf3",formGroup:"ProductUploadPage_formGroup__Hra1x",input:"ProductUploadPage_input__Z9UiO",textarea:"ProductUploadPage_textarea__AJkj0",fileInput:"ProductUploadPage_fileInput__G_gC_",previews:"ProductUploadPage_previews__p0Yj2",preview:"ProductUploadPage_preview__lUl4_",thumbnail:"ProductUploadPage_thumbnail__RPS7u",uploadButton:"ProductUploadPage_uploadButton___TKIp",saveButton:"ProductUploadPage_saveButton__9UzbH",cancelButton:"ProductUploadPage_cancelButton__o9Ysp",editButton:"ProductUploadPage_editButton__C_Rti",productListTitle:"ProductUploadPage_productListTitle__PO9VX",productList:"ProductUploadPage_productList__LL8rF",productCard:"ProductUploadPage_productCard__gBi4d",thumbnailList:"ProductUploadPage_thumbnailList__BnQX7",editModalOverlay:"ProductUploadPage_editModalOverlay__IMaP1",editModal:"ProductUploadPage_editModal__8RhfU",new:"ProductUploadPage_new__EqH1b",body:"ProductUploadPage_body__MMNxv",h1:"ProductUploadPage_h1__KhBsk",h2:"ProductUploadPage_h2__sjDU6",h3:"ProductUploadPage_h3__MIbuh",deleteButton:"ProductUploadPage_deleteButton__VL780"}}},e=>{var a=a=>e(e.s=a);e.O(0,[5869,5974,8441,1517,7358],()=>a(13425)),_N_E=e.O()}]);