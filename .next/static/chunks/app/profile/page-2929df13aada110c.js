(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{58980:(e,s,i)=>{Promise.resolve().then(i.bind(i,95046))},95046:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>p});var a=i(95155),r=i(12115),l=i(76046),o=i(27364),t=i(36818),n=i.n(t),u=i(48173),d=i.n(u),c=i(5565);function p(){let[e,s]=(0,r.useState)(null),[i,t]=(0,r.useState)(!0),[u,p]=(0,r.useState)(null),[f,_]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),[v,P]=(0,r.useState)(!1),[b,g]=(0,r.useState)(!1),x=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=JSON.parse(sessionStorage.getItem("user")||"{}");if(!(null==e?void 0:e.email)){x.push("/login");return}(async()=>{try{let{data:i,error:a}=await o.N.from("users").select("*").eq("email",e.email).single();if(a)throw Error(a.message);s(i)}catch(e){p("Failed to fetch user data.")}finally{t(!1)}})()},[x]);let N=async()=>{if(!f||!e)return;P(!0);let i=f.name.split(".").pop(),a="user_pic_".concat(e.email,"_").concat(Date.now(),".").concat(i);try{let{data:i,error:r}=await o.N.storage.from("user-photos").upload("user_photos/user_pic/".concat(a),f);if(r)throw Error("Error uploading photo");let{publicUrl:l}=o.N.storage.from("user-photos").getPublicUrl("user_photos/user_pic/".concat(a)).data,{error:t}=await o.N.from("users").update({photo:l}).eq("email",e.email);if(t)throw Error("Error updating user profile");s(e=>({...e,photo:l})),m(l),g(!0),setTimeout(()=>g(!1),2e3)}catch(e){p(e instanceof Error?e.message:"An unknown error occurred.")}finally{P(!1)}},w=async()=>{if(e)try{let{error:s}=await o.N.from("users").update({name:e.name,address:e.address,phone:e.phone,business_name:e.business_name,business_address:e.business_address,business_type:e.business_type,product_service:e.product_service,business_experience:e.business_experience,business_description:e.business_description}).eq("email",e.email);if(s)throw Error("Failed to save changes.");g(!0),setTimeout(()=>g(!1),2e3)}catch(e){p(e instanceof Error?e.message:"An unknown error occurred.")}};return i?(0,a.jsx)("p",{children:"Loading..."}):u?(0,a.jsx)("p",{children:u}):(0,a.jsxs)("div",{className:n().container,children:[(0,a.jsx)("h1",{className:n().title,children:"Edit Profile"}),(0,a.jsx)("div",{children:(0,a.jsx)(d(),{href:"/business/product",className:n().links,children:"Add Products"})}),(0,a.jsxs)("div",{className:n().profileInfo,children:[(0,a.jsxs)("div",{className:n().profilePhotoContainer,children:[(0,a.jsx)(c.default,{src:(null==e?void 0:e.photo)||"/default-profile.png",alt:"Profile Photo",className:n().profilePhoto,width:150,height:150}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var s;let i=null===(s=e.target.files)||void 0===s?void 0:s[0];if(i){_(i);let e=new FileReader;e.onloadend=()=>{m(e.result)},e.readAsDataURL(i)}},className:n().fileInput}),(0,a.jsx)("button",{onClick:N,disabled:v,className:n().uploadButton,children:v?"Uploading...":"Upload New Photo"})]}),h&&(0,a.jsxs)("div",{className:n().photoPreviewContainer,children:[(0,a.jsx)("h3",{children:"Preview"}),(0,a.jsx)(c.default,{src:h,alt:"Preview Image",width:200,height:200,className:n().previewImg})]}),(0,a.jsxs)("div",{className:n().formContainer,children:[[{label:"Name",value:null==e?void 0:e.name,field:"name"},{label:"Email",value:null==e?void 0:e.email,field:"email",disabled:!0},{label:"Address",value:null==e?void 0:e.address,field:"address"},{label:"Phone",value:null==e?void 0:e.phone,field:"phone"},{label:"Business Name",value:null==e?void 0:e.business_name,field:"business_name"},{label:"Business Address",value:null==e?void 0:e.business_address,field:"business_address"},{label:"Business Type",value:null==e?void 0:e.business_type,field:"business_type"},{label:"Product/Service",value:null==e?void 0:e.product_service,field:"product_service"},{label:"Business Experience",value:null==e?void 0:e.business_experience,field:"business_experience"},{label:"Business Description",value:null==e?void 0:e.business_description,field:"business_description"}].map(i=>{let{label:r,value:l,field:o,disabled:t}=i;return(0,a.jsxs)("div",{className:n().inputGroup,children:[(0,a.jsx)("label",{children:r}),(0,a.jsx)("input",{type:"text",value:l||"",onChange:i=>s({...e,[o]:i.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg mb-4 bg-gray-800 text-gray-300 py-2 px-4",disabled:t})]},o)}),(0,a.jsx)("button",{onClick:w,className:n().saveButton,children:"Save Changes"})]})]}),(0,a.jsx)("div",{className:"".concat(n().popup," ").concat(b?n().show:""),children:(0,a.jsx)("p",{children:"Update Successful"})})]})}},27364:(e,s,i)=>{"use strict";i.d(s,{N:()=>a});let a=(0,i(35974).UU)("https://mdxeolqfiosscdommyhc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1keGVvbHFmaW9zc2Nkb21teWhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk4ODc2NDMsImV4cCI6MjA0NTQ2MzY0M30.6FDluVEiMbeaxQI9BD633IhtxnEwh3f5WzGT5YDOylA",{auth:{persistSession:!0,autoRefreshToken:!0}})},76046:(e,s,i)=>{"use strict";var a=i(66658);i.o(a,"useParams")&&i.d(s,{useParams:function(){return a.useParams}}),i.o(a,"usePathname")&&i.d(s,{usePathname:function(){return a.usePathname}}),i.o(a,"useRouter")&&i.d(s,{useRouter:function(){return a.useRouter}})},36818:e=>{e.exports={container:"ProfilePage_container__dPJxZ",title:"ProfilePage_title__Tedud",links:"ProfilePage_links__kEt1x",profileInfo:"ProfilePage_profileInfo__28J4J",profilePhotoContainer:"ProfilePage_profilePhotoContainer___OqTV",profilePhoto:"ProfilePage_profilePhoto__OZcQF",fileInput:"ProfilePage_fileInput__ARie3",uploadButton:"ProfilePage_uploadButton__u_DiX",photoPreviewContainer:"ProfilePage_photoPreviewContainer__jWGfR",previewImg:"ProfilePage_previewImg__ZRMSF",formContainer:"ProfilePage_formContainer__ZZoRU",inputGroup:"ProfilePage_inputGroup__cUYUh",saveButton:"ProfilePage_saveButton__LF62_",popup:"ProfilePage_popup__YUxv7",show:"ProfilePage_show__46irL"}}},e=>{var s=s=>e(e.s=s);e.O(0,[4281,5974,8173,5565,8441,1517,7358],()=>s(58980)),_N_E=e.O()}]);