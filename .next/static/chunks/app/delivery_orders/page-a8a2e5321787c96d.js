(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1261],{91195:(e,t,a)=>{Promise.resolve().then(a.bind(a,43683))},43683:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var l=a(95155),s=a(12115),r=a(76046),i=a(10142),n=a(92340),c=a.n(n);function d(){let e;let[t,a]=(0,s.useState)(null),[n,d]=(0,s.useState)([]),[o,h]=(0,s.useState)([]),[u,x]=(0,s.useState)(null),[j,v]=(0,s.useState)(0),[m,p]=(0,s.useState)(1),[g,f]=(0,s.useState)(1),[b,S]=(0,s.useState)(1),[D,y]=(0,s.useState)(""),[N,C]=(0,s.useState)(""),[P,w]=(0,s.useState)(""),F=(0,r.useRouter)();(0,s.useEffect)(()=>{let e=JSON.parse(sessionStorage.getItem("user")||"{}");if(!(null==e?void 0:e.email)){F.push("/login");return}a(e.email),async function(){try{let t=await fetch("/api/sheets");if(!t.ok){let e=await t.text();throw Error("HTTP error! Status: ".concat(t.status,", Details: ").concat(e))}let a=(await t.json()).data.filter(t=>{var a;return(null===(a=t[9])||void 0===a?void 0:a.trim())===e.email.trim()}),l=a.slice(1).reduce((e,t)=>e+(parseFloat(t[5])||0),0);d(a),h(a),v(l)}catch(e){console.error("Error fetching data:",e),x("Failed to fetch data: ".concat(String(e)))}}()},[F]),(0,s.useEffect)(()=>{let e=n;if(""!==D.trim()){let t=D.toLowerCase();e=e.filter(e=>e.some(e=>e.toLowerCase().includes(t)))}"Pending"===N?e=e.filter(e=>{var t;return null===(t=e[7])||void 0===t?void 0:t.startsWith("Pen")}):"Out for Delivery"===N?e=e.filter(e=>{var t;return null===(t=e[7])||void 0===t?void 0:t.startsWith("Out")}):"Delivery by Date"===N&&P&&(e=e.filter(e=>{var t;return null===(t=e[7])||void 0===t?void 0:t.includes(P)})),h(e),p(1)},[D,N,P,n]);let _=Math.ceil((o.length-1)/15),k=o.slice(1+(m-1)*15,1+15*m);return(0,l.jsxs)("div",{className:"container",children:[(0,l.jsx)("h1",{className:"title",children:"My Google Sheets Data"}),t&&(0,l.jsxs)("p",{className:"info",children:["Logged in as: ",(0,l.jsx)("strong",{children:t})]}),(0,l.jsxs)("p",{className:"total-balance",children:[(0,l.jsx)("strong",{children:"Total Balance:"})," ",j.toFixed(2)]}),u?(0,l.jsx)("p",{className:"error",children:u}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"filter-container",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search...",value:D,onChange:e=>y(e.target.value)}),(0,l.jsxs)("select",{value:N,onChange:e=>{C(e.target.value),"Delivery by Date"!==e.target.value&&w("")},children:[(0,l.jsx)("option",{value:"",children:"Filter by Status"}),(0,l.jsx)("option",{value:"Pending",children:"Pending"}),(0,l.jsx)("option",{value:"Out for Delivery",children:"Out for Delivery"}),(0,l.jsx)("option",{value:"Delivery by Date",children:"Delivery by Date"})]}),"Delivery by Date"===N&&(0,l.jsxs)("select",{value:P,onChange:e=>w(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select Delivery Date"}),[...new Set(n.map(e=>e[7]))].filter(e=>e.startsWith("Deliver")).map((e,t)=>(0,l.jsx)("option",{value:e,children:e},t))]})]}),(0,l.jsx)("div",{className:"table-container",children:(0,l.jsxs)("table",{className:"styled-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Sl"}),(0,l.jsx)("th",{children:"Date"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Address"}),(0,l.jsx)("th",{children:"PB"}),(0,l.jsx)("th",{children:"DC"}),(0,l.jsx)("th",{children:"TSB"}),(0,l.jsx)("th",{children:"Note"}),(0,l.jsx)("th",{children:"Status"}),(0,l.jsx)("th",{children:"Cumulative Balance"})]})}),(0,l.jsx)("tbody",{children:(e=o.slice(1,1+(m-1)*15).reduce((e,t)=>e+(parseFloat(t[5])||0),0),k.map((t,a)=>{let s=parseFloat(t[5])||0;return e+=s,(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(m-1)*15+a+1})," ",(0,l.jsx)("td",{children:t[0]})," ",(0,l.jsx)("td",{children:t[1]})," ",(0,l.jsx)("td",{children:t[2]})," ",(0,l.jsx)("td",{children:t[3]})," ",(0,l.jsx)("td",{children:t[4]})," ",(0,l.jsx)("td",{children:t[5]})," ",(0,l.jsx)("td",{children:t[6]})," ",(0,l.jsx)("td",{children:t[7]})," ",(0,l.jsx)("td",{children:e.toFixed(2)})," "]},a)}))})]})}),(0,l.jsxs)("div",{className:"pagination",children:[(0,l.jsx)("button",{disabled:1===m,onClick:()=>p(e=>Math.max(e-1,1)),children:"Previous"}),(0,l.jsxs)("span",{children:["Page ",m," of ",_]}),(0,l.jsx)("button",{disabled:m===_,onClick:()=>p(e=>Math.min(e+1,_)),children:"Next"})]}),(0,l.jsxs)("div",{className:"pdf-selection",children:[(0,l.jsx)("label",{children:"From Page:"}),(0,l.jsx)("input",{type:"number",value:g,onChange:e=>f(Number(e.target.value)),min:1,max:_}),(0,l.jsx)("label",{children:"To Page:"}),(0,l.jsx)("input",{type:"number",value:b,onChange:e=>S(Number(e.target.value)),min:1,max:_}),(0,l.jsx)("button",{onClick:()=>{if(g<1||b>_||g>b){alert("Invalid page range selected.");return}let e=new i.default;e.text("Data from Page ".concat(g," to ").concat(b),10,10);let t=[];for(let e=g;e<=b;e++){let a=1+(e-1)*15,l=1+15*e;t.push(...o.slice(a,l))}c()(e,{head:[["Sl","Date","Name","Address","PB","DC","TSB","Note","Status","Cumulative Balance"]],body:t.map((e,t)=>[t+1,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]])}),e.save("data_pages_".concat(g,"_to_").concat(b,".pdf"))},children:"Download PDF"})]})]})]})}a(75073)},75073:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[248,3930,3737,8441,1517,7358],()=>t(91195)),_N_E=e.O()}]);